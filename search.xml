<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>关于mybatis中collection一对多关联查询分页出错问题总结</title>
      <link href="//posts/20190304--%E5%85%B3%E4%BA%8Emybatis%E4%B8%ADcollection%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E5%88%86%E9%A1%B5%E5%87%BA%E9%94%99%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/"/>
      <url>//posts/20190304--%E5%85%B3%E4%BA%8Emybatis%E4%B8%ADcollection%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E5%88%86%E9%A1%B5%E5%87%BA%E9%94%99%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>mybatis分页查询,使用了collection进行一对多关联时,出现分页不正确的问题<br><img src="/medias/images/201903050938.jpg" width="300" height="120" alt="订单分页"><br>分页的每页记录数pageSize=5,如图查询结果首页只有4条订单数据.</p><h3 id="分析原因"><a href="#分析原因" class="headerlink" title="分析原因"></a>分析原因</h3><p>在订单查询中,涉及订单和订单流水两张表,一个订单对应一个或多个流水<br>OrderMapper.xml中使用collection进行嵌套查询<br>错误写法:</p><pre><code>&lt;resultMap type=&quot;Order&quot; id=&quot;ContractDetailed&quot;&gt;    &lt;result property=&quot;orderNo&quot; column=&quot;orderNo&quot; /&gt;    &lt;result property=&quot;sumMoney&quot; column=&quot;sumMoney&quot; /&gt;    &lt;result property=&quot;couponAmount&quot; column=&quot;couponAmount&quot; /&gt;    &lt;result property=&quot;createTime&quot; column=&quot;createTime&quot; /&gt;    &lt;result property=&quot;payTime&quot; column=&quot;payTime&quot; /&gt;    &lt;result property=&quot;states&quot; column=&quot;states&quot; /&gt;    &lt;result property=&quot;payType&quot; column=&quot;payType&quot; /&gt;    &lt;result property=&quot;orderId&quot; column=&quot;orderId&quot; /&gt;    &lt;result property=&quot;orderType&quot; column=&quot;orderType&quot; /&gt;    &lt;collection property=&quot;trxorderDetailList&quot; ofType=&quot;TrxorderDetailDTO&quot;&gt;        &lt;result column=&quot;trxorderDetailId&quot; property=&quot;trxorderDetailId&quot; /&gt;        &lt;result column=&quot;courseId&quot; property=&quot;courseId&quot; /&gt;        &lt;result column=&quot;currentPrice&quot; property=&quot;currentPirce&quot; /&gt;        &lt;result column=&quot;courseName&quot; property=&quot;courseName&quot; /&gt;    &lt;/collection&gt;&lt;/resultMap&gt;&lt;select id=&quot;queryOrderForUc&quot; resultMap=&quot;ContractDetailed&quot; parameterType=&quot;java.util.HashMap&quot;&gt;    SELECT        &lt;include refid=&quot;orders_columns&quot; /&gt;    FROM         edu_orders    LEFT JOIN         edu_trxorder_detail ON edu_orders.ORDER_ID = edu_trxorder_detail.trxorder_id&lt;/select&gt;</code></pre><p>正确写法:</p><pre><code>&lt;resultMap id=&quot;ContractDetailed&quot; type=&quot;Order&quot;&gt;    &lt;result property=&quot;orderNo&quot; column=&quot;orderNo&quot; /&gt;    &lt;result property=&quot;sumMoney&quot; column=&quot;sumMoney&quot; /&gt;    &lt;result property=&quot;couponAmount&quot; column=&quot;couponAmount&quot; /&gt;    &lt;result property=&quot;createTime&quot; column=&quot;createTime&quot; /&gt;    &lt;result property=&quot;payTime&quot; column=&quot;payTime&quot; /&gt;    &lt;result property=&quot;states&quot; column=&quot;states&quot; /&gt;    &lt;result property=&quot;payType&quot; column=&quot;payType&quot; /&gt;    &lt;result property=&quot;orderId&quot; column=&quot;orderId&quot; /&gt;    &lt;result property=&quot;orderType&quot; column=&quot;orderType&quot; /&gt;    &lt;collection property=&quot;trxorderDetailList&quot; ofType=&quot;TrxorderDetailDTO&quot; column=&quot;trxorder_id&quot;  select=&quot;getDetailInfoByOrderId&quot;&gt;&lt;/collection&gt;&lt;/resultMap&gt;&lt;select id=&quot;queryOrderForUc&quot; resultMap=&quot;ContractDetailed&quot; parameterType=&quot;java.util.HashMap&quot;&gt;    SELECT        &lt;include refid=&quot;orders_columns&quot; /&gt;    FROM edu_orders&lt;/select&gt;&lt;resultMap id=&quot;detailInfoMap&quot; type=&quot;TrxorderDetailDTO&quot;&gt;    &lt;id column=&quot;trxorder_id&quot; property=&quot;id&quot;/&gt;    &lt;result column=&quot;courseId&quot; property=&quot;courseId&quot; /&gt;    &lt;result column=&quot;currentPrice&quot; property=&quot;currentPirce&quot; /&gt;    &lt;result column=&quot;courseName&quot; property=&quot;courseName&quot; /&gt;&lt;/resultMap&gt;&lt;select id=&quot;getDetailInfoByOrderId&quot; parameterType=&quot;java.lang.Long&quot; resultMap=&quot;detailInfoMap&quot;&gt;    SELECT        &lt;include refid=&quot;trxorder_detail_columns&quot; /&gt;    FROM        edu_trxorder_detail     WHERE          edu_trxorder_detail.trxorder_id=#{id}&lt;/select&gt;</code></pre><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>当使用MyBatis进行查询的时候如果一个 JavaBean 中包含另一个 JavaBean 或者 Collection 时，可以通过 MyBatis 的嵌套查询来获取需要的结果;<br>① Collection 同一个查询映射到属性的嵌套<br>&emsp;&emsp;如果在一个查询中可以直接查询到所需要的数据，但是需要映射到该对象的属性上，则可以使用该方式.<br>&emsp;&emsp;但在分页时,它会将collection中查询到的条数作为分页约束,从而出现分页不正确的问题<br>② Collection 一个查询调用另一个查询实现的嵌套<br>&emsp;&emsp;collection : 一个复杂的类型关联，许多结果将映射为这种类型<br>&emsp;&emsp;property : 这是关联的 JavaBean 中的属性名<br>&emsp;&emsp;javaType : property 属性对应的集合类型<br>&emsp;&emsp;ofType : property 集合中的泛型<br>&emsp;&emsp;column : RoleModel 的 id ，作为参数传入被调用的 Select 语句<br>&emsp;&emsp;select : 另外一个映射语句的 ID</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>个人博客-初体验</title>
      <link href="//posts/20190301--%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2-%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>//posts/20190301--%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2-%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h3 id="人需要沉淀-要有足够的时间去反思-才能让自己变得更完美"><a href="#人需要沉淀-要有足够的时间去反思-才能让自己变得更完美" class="headerlink" title="人需要沉淀,要有足够的时间去反思,才能让自己变得更完美"></a>人需要沉淀,要有足够的时间去反思,才能让自己变得更完美</h3><p>本博客基于 Hexo 的 <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank" rel="noopener">hexo-theme-matery</a>主题搭建</p>]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
